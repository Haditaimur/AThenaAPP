<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Maintenance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const HotelMaintenanceApp = () => {
            const [currentScreen, setCurrentScreen] = useState('role-select');
            const [selectedJob, setSelectedJob] = useState(null);
            const [currentRole, setCurrentRole] = useState(null);
            const [rooms, setRooms] = useState([]);
            const [jobs, setJobs] = useState([]);
            const [dataLoaded, setDataLoaded] = useState(false);
            const [formData, setFormData] = useState({
                room: '',
                title: '',
                description: '',
                status: 'To Do',
                photo: null
            });
            const [completionNote, setCompletionNote] = useState('');
            const [selectedFloor, setSelectedFloor] = useState(null);
            const [selectedRoom, setSelectedRoom] = useState(null);
            const [enlargedPhoto, setEnlargedPhoto] = useState(null);
            const [isEditingJob, setIsEditingJob] = useState(false);
            const [editFormData, setEditFormData] = useState({
                title: '',
                description: ''
            });
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [jobToDelete, setJobToDelete] = useState(null);

            // Floor definitions
            const floors = [
                { id: 'general', name: 'General / Other', label: '⚙️' },
                { id: '-1', name: 'Basement', label: 'B' },
                { id: '0', name: 'Ground Floor', label: 'G' },
                { id: '1', name: 'First Floor', label: '1' },
                { id: '2', name: 'Second Floor', label: '2' },
                { id: '3', name: 'Third Floor', label: '3' },
                { id: '4', name: 'Fourth Floor', label: '4' }
            ];

            useEffect(() => {
                loadData();
            }, []);

            const loadData = () => {
                console.log('Loading data from localStorage...');
                
                const defaultRooms = [
                    { id: '0', number: 'General', floor: 'general', notes: 'Not room-specific' },
                    { id: '1', number: '51', floor: '-1', notes: 'Triple Room' },
                    { id: '2', number: '52', floor: '-1', notes: 'Triple Room' },
                    { id: '3', number: '53', floor: '-1', notes: 'Twin Room' },
                    { id: '4', number: '54', floor: '-1', notes: 'Triple Room' },
                    { id: '5', number: '1', floor: '0', notes: 'Single Room' },
                    { id: '6', number: '2', floor: '0', notes: 'Family Room' },
                    { id: '7', number: '3', floor: '0', notes: 'Double Room' },
                    { id: '8', number: '4', floor: '0', notes: 'Double Room' },
                    { id: '9', number: '5', floor: '0', notes: 'Twin Room' },
                    { id: '10', number: '6', floor: '0', notes: 'Triple Room' },
                    { id: '11', number: '7', floor: '0', notes: 'Family Room' },
                    { id: '12', number: '2b', floor: '0', notes: 'Twin Room' },
                    { id: '13', number: '8', floor: '0', notes: 'Twin Room' },
                    { id: '14', number: '11', floor: '1', notes: 'Triple Room' },
                    { id: '15', number: '12', floor: '1', notes: 'Triple Room' },
                    { id: '16', number: '12', floor: '1', notes: 'Triple Room' },
                    { id: '17', number: '13', floor: '1', notes: 'Quad Room' },
                    { id: '18', number: '14', floor: '1', notes: 'Family Room' },
                    { id: '19', number: '15', floor: '1', notes: 'Double Room' },
                    { id: '20', number: '16', floor: '1', notes: 'Double Room' },
                    { id: '21', number: '9', floor: '1', notes: 'Single Room' },
                    { id: '22', number: '5b', floor: '1', notes: 'Single Room' },
                    { id: '23', number: '21', floor: '2', notes: 'Family Room' },
                    { id: '24', number: '22', floor: '2', notes: 'Family Room' },
                    { id: '25', number: '23', floor: '2', notes: 'Family Room' },
                    { id: '26', number: '24', floor: '2', notes: 'Family Room' },
                    { id: '27', number: '25', floor: '2', notes: 'Double Room' },
                    { id: '28', number: '26', floor: '2', notes: 'Double Room' },
                    { id: '29', number: '31', floor: '3', notes: 'Quad Room' },
                    { id: '30', number: '32', floor: '3', notes: 'Quad Room' },
                    { id: '31', number: '33', floor: '3', notes: 'Quad Room' },
                    { id: '32', number: '34', floor: '3', notes: 'Triple Room' },
                    { id: '33', number: '35', floor: '3', notes: 'Double Room' },
                    { id: '34', number: '36', floor: '3', notes: 'Double Room' },
                    { id: '35', number: '41', floor: '4', notes: 'Triple Room' },
                    { id: '36', number: '42', floor: '4', notes: 'Triple Room' },
                    { id: '37', number: '43', floor: '4', notes: 'Triple Room' },
                    { id: '38', number: '44', floor: '4', notes: 'Triple Room' },
                    { id: '39', number: '45', floor: '4', notes: 'Single Room' },
                    { id: '40', number: '46', floor: '4', notes: 'Single Room' }
                ];

                setRooms(defaultRooms);

                // Load jobs from localStorage
                const savedJobs = localStorage.getItem('hotel-jobs');
                if (savedJobs) {
                    const parsedJobs = JSON.parse(savedJobs);
                    console.log('Loaded jobs from localStorage:', parsedJobs.length);
                    setJobs(parsedJobs);
                } else {
                    // Initialize with sample data
                    const sampleJobs = [
                        { id: 'job-14', roomId: '0', roomNumber: 'General', floor: 'general', title: 'Exterior Sign Repair', description: 'Hotel entrance sign light not working', status: 'Urgent', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-15', roomId: '0', roomNumber: 'General', floor: 'general', title: 'Parking Lot Pothole', description: 'Large pothole near entrance needs repair', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-1', roomId: '2', roomNumber: '52', floor: '-1', title: 'Washing Machine Repair', description: 'Main washing machine making loud noise', status: 'Urgent', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-2', roomId: '3', roomNumber: '53', floor: '-1', title: 'Water Heater Check', description: 'Annual maintenance check needed', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-3', roomId: '5', roomNumber: '1', floor: '0', title: 'Reception Desk Light', description: 'Main desk light flickering', status: 'Urgent', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-4', roomId: '10', roomNumber: '6', floor: '0', title: 'Kitchen Sink Leak', description: 'Small leak under kitchen sink', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-5', roomId: '14', roomNumber: '11', floor: '1', title: 'Shower Leak', description: 'Water leaking from shower head connection', status: 'Urgent', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-6', roomId: '15', roomNumber: '12', floor: '1', title: 'Bedside Lamp Flickering', description: 'Left bedside lamp flickering intermittently', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-7', roomId: '18', roomNumber: '14', floor: '1', title: 'Window Lock Broken', description: 'Window lock needs replacement', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-8', roomId: '24', roomNumber: '22', floor: '2', title: 'AC Not Working', description: 'Air conditioning unit not responding', status: 'Urgent', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-9', roomId: '25', roomNumber: '23', floor: '2', title: 'Loose Bathroom Tile', description: 'Floor tile near sink is loose', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-10', roomId: '29', roomNumber: '31', floor: '3', title: 'Window Handle Loose', description: 'Window handle needs tightening', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-11', roomId: '30', roomNumber: '32', floor: '3', title: 'Curtain Rail Fixed', description: 'Curtain rail repaired and secured', status: 'Done', photo: null, completionNote: 'Replaced mounting brackets', createdAt: new Date(Date.now() - 86400000).toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-16', roomId: '31', roomNumber: '33', floor: '3', title: 'Bathroom Mirror Cracked', description: 'Mirror needs replacement', status: 'Done', photo: null, completionNote: 'Replaced with new mirror', createdAt: new Date(Date.now() - 172800000).toISOString(), updatedAt: new Date(Date.now() - 86400000).toISOString() },
                        { id: 'job-17', roomId: '32', roomNumber: '34', floor: '3', title: 'TV Remote Not Working', description: 'Remote control batteries dead', status: 'Done', photo: null, completionNote: 'Replaced batteries', createdAt: new Date(Date.now() - 259200000).toISOString(), updatedAt: new Date(Date.now() - 172800000).toISOString() },
                        { id: 'job-12', roomId: '35', roomNumber: '41', floor: '4', title: 'Balcony Door Lock', description: 'Balcony door lock is stuck', status: 'To Do', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                        { id: 'job-13', roomId: '38', roomNumber: '44', floor: '4', title: 'Minibar Not Cooling', description: 'Presidential suite minibar not cooling properly', status: 'Urgent', photo: null, completionNote: '', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }
                    ];
                    
                    localStorage.setItem('hotel-jobs', JSON.stringify(sampleJobs));
                    setJobs(sampleJobs);
                    console.log('Initialized sample jobs in localStorage');
                }

                setDataLoaded(true);
            };

            const saveJobs = (updatedJobs) => {
                setJobs(updatedJobs);
                localStorage.setItem('hotel-jobs', JSON.stringify(updatedJobs));
            };

            const updateJobStatus = (jobId, newStatus, note = '') => {
                const updatedJobs = jobs.map(job => {
                    if (job.id === jobId) {
                        const room = rooms.find(r => String(r.id) === String(job.roomId));
                        return {
                            ...job,
                            status: newStatus,
                            completionNote: note || job.completionNote || '',
                            floor: job.floor || (room ? room.floor : 'unknown'),
                            updatedAt: new Date().toISOString()
                        };
                    }
                    return job;
                });
                saveJobs(updatedJobs);
                setSelectedJob(updatedJobs.find(j => j.id === jobId));
                setCompletionNote('');
            };

            const updateJobDetails = (jobId, title, description) => {
                const updatedJobs = jobs.map(job => {
                    if (job.id === jobId) {
                        const room = rooms.find(r => String(r.id) === String(job.roomId));
                        return {
                            ...job,
                            title: title,
                            description: description,
                            floor: job.floor || (room ? room.floor : 'unknown'),
                            updatedAt: new Date().toISOString()
                        };
                    }
                    return job;
                });
                saveJobs(updatedJobs);
                setSelectedJob(updatedJobs.find(j => j.id === jobId));
                setIsEditingJob(false);
            };

            const updateJobPhoto = (jobId, photoData) => {
                const updatedJobs = jobs.map(job =>
                    job.id === jobId
                        ? { ...job, photo: photoData, updatedAt: new Date().toISOString() }
                        : job
                );
                saveJobs(updatedJobs);
                setSelectedJob(updatedJobs.find(j => j.id === jobId));
            };

            const deleteJob = (jobId) => {
                console.log('Delete initiated for job:', jobId);
                
                const updatedJobs = jobs.filter(job => job.id !== jobId);
                console.log('Jobs before:', jobs.length, 'Jobs after:', updatedJobs.length);
                
                saveJobs(updatedJobs);
                
                setShowDeleteConfirm(false);
                setJobToDelete(null);
                setCurrentScreen('home');
            };

            const initiateDelete = (jobId) => {
                setJobToDelete(jobId);
                setShowDeleteConfirm(true);
            };

            const cancelDelete = () => {
                setShowDeleteConfirm(false);
                setJobToDelete(null);
            };

            const addNewJob = () => {
                const room = rooms.find(r => r.id === formData.room);
                if (!room || !formData.title) return;

                const newJob = {
                    id: `job-${Date.now()}`,
                    roomId: room.id,
                    roomNumber: room.number,
                    floor: room.floor,
                    title: formData.title,
                    description: formData.description,
                    status: formData.status,
                    photo: formData.photo,
                    completionNote: '',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                const updatedJobs = [...jobs, newJob];
                saveJobs(updatedJobs);
                
                setFormData({
                    room: '',
                    title: '',
                    description: '',
                    status: 'To Do',
                    photo: null
                });
                setCurrentScreen('home');
            };

            const handlePhotoUpload = (e, jobId = null) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        if (jobId) {
                            updateJobPhoto(jobId, reader.result);
                        } else {
                            setFormData({ ...formData, photo: reader.result });
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            const getStatusBadge = (status) => {
                const styles = {
                    'Urgent': 'bg-red-500 text-white',
                    'To Do': 'bg-yellow-500 text-black',
                    'Done': 'bg-green-500 text-white'
                };
                return styles[status] || 'bg-gray-500 text-white';
            };

            const getJobsByStatus = (status) => {
                return jobs.filter(job => job.status === status);
            };

            const groupJobsByRoom = (jobsList) => {
                const grouped = {};
                jobsList.forEach(job => {
                    if (!grouped[job.roomNumber]) {
                        grouped[job.roomNumber] = [];
                    }
                    grouped[job.roomNumber].push(job);
                });
                return grouped;
            };

            const getRoomsByFloor = (floorId) => {
                return rooms.filter(room => String(room.floor) === String(floorId));
            };

            const getJobsByRoomAndStatus = (roomId, status) => {
                if (status === 'To Do') {
                    return jobs.filter(job =>
                        String(job.roomId) === String(roomId) &&
                        (job.status === 'To Do' || job.status === 'Urgent')
                    );
                }
                return jobs.filter(job =>
                    String(job.roomId) === String(roomId) &&
                    job.status === status
                );
            };

            const getJobCountByFloor = (floorId, status) => {
                let count = 0;
                
                if (status === 'To Do') {
                    count = jobs.filter(job =>
                        String(job.floor) === String(floorId) &&
                        (job.status === 'To Do' || job.status === 'Urgent')
                    ).length;
                } else {
                    count = jobs.filter(job =>
                        String(job.floor) === String(floorId) &&
                        job.status === status
                    ).length;
                }
                
                return count;
            };

            const getJobCountByRoom = (roomId, status) => {
                let count = 0;
                
                if (status === 'To Do') {
                    count = jobs.filter(job =>
                        String(job.roomId) === String(roomId) &&
                        (job.status === 'To Do' || job.status === 'Urgent')
                    ).length;
                } else {
                    count = jobs.filter(job =>
                        String(job.roomId) === String(roomId) &&
                        job.status === status
                    ).length;
                }
                
                return count;
            };

            const selectRole = (role) => {
                setCurrentRole(role);
                setCurrentScreen('home');
            };

            const handleLogout = () => {
                setCurrentRole(null);
                setCurrentScreen('role-select');
                setSelectedFloor(null);
                setSelectedRoom(null);
            };

            // ROLE SELECTION SCREEN
            if (currentScreen === 'role-select') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center p-4">
                        <div className="max-w-md w-full">
                            <div className="bg-white rounded-lg shadow-2xl p-8">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-2">Hotel Maintenance</h1>
                                    <p className="text-gray-600">Select Your Role</p>
                                </div>

                                <div className="space-y-4">
                                    <button
                                        onClick={() => selectRole('manager')}
                                        className="w-full bg-blue-600 text-white p-6 rounded-lg text-xl font-semibold hover:bg-blue-700 transition shadow-lg transform hover:scale-105"
                                    >
                                        <div className="flex items-center justify-center gap-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                            <span>Manager</span>
                                        </div>
                                        <p className="text-sm text-blue-100 mt-2">Full access - add, edit, delete jobs</p>
                                    </button>

                                    <button
                                        onClick={() => selectRole('handyman')}
                                        className="w-full bg-green-600 text-white p-6 rounded-lg text-xl font-semibold hover:bg-green-700 transition shadow-lg transform hover:scale-105"
                                    >
                                        <div className="flex items-center justify-center gap-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                                            <span>Handyman</span>
                                        </div>
                                        <p className="text-sm text-green-100 mt-2">Add, view and update jobs</p>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // HOME SCREEN  
            if (currentScreen === 'home') {
                const urgentCount = getJobsByStatus('Urgent').length;
                const todoCount = getJobsByStatus('To Do').length + getJobsByStatus('Urgent').length;
                const doneCount = getJobsByStatus('Done').length;

                return (
                    <div className="min-h-screen bg-gray-100 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-lg shadow-md p-6 mb-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h1 className="text-2xl font-bold text-gray-800">Maintenance Tracker</h1>
                                    <button
                                        onClick={handleLogout}
                                        className="p-2 px-4 bg-red-500 text-white rounded-lg hover:bg-red-600 transition font-semibold"
                                    >
                                        Logout
                                    </button>
                                </div>
                                <p className="text-sm text-gray-600">Role: <span className="font-semibold capitalize">{currentRole}</span></p>
                            </div>

                            <div className="space-y-4">
                                <button
                                    onClick={() => setCurrentScreen('urgent')}
                                    className="w-full bg-red-500 text-white p-8 rounded-lg shadow-lg hover:bg-red-600 transition"
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="text-left">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mb-2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                                            <h2 className="text-2xl font-bold">Urgent Jobs</h2>
                                            <p className="text-red-100 mt-1">Immediate attention required</p>
                                        </div>
                                        <div className="text-5xl font-bold">{urgentCount}</div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setCurrentScreen('todo-floors')}
                                    className="w-full bg-yellow-500 text-black p-8 rounded-lg shadow-lg hover:bg-yellow-600 transition"
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="text-left">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mb-2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                            <h2 className="text-2xl font-bold">To Do Jobs</h2>
                                            <p className="text-yellow-900 mt-1">Scheduled maintenance</p>
                                        </div>
                                        <div className="text-5xl font-bold">{todoCount}</div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setCurrentScreen('done-floors')}
                                    className="w-full bg-green-500 text-white p-8 rounded-lg shadow-lg hover:bg-green-600 transition"
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="text-left">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mb-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                                            <h2 className="text-2xl font-bold">Done Jobs</h2>
                                            <p className="text-green-100 mt-1">Completed tasks</p>
                                        </div>
                                        <div className="text-5xl font-bold">{doneCount}</div>
                                    </div>
                                </button>
                            </div>

                            <button
                                onClick={() => setCurrentScreen('add')}
                                className={`w-full mt-4 ${currentRole === 'manager' ? 'bg-blue-600' : 'bg-green-600'} text-white p-4 rounded-lg shadow-lg hover:opacity-90 transition flex items-center justify-center gap-2`}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                <span className="text-xl font-semibold">Add New Job</span>
                            </button>
                        </div>
                    </div>
                );
            }

            // Continue rendering other screens...
            return <div className="p-8 text-center">Screen: {currentScreen}</div>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HotelMaintenanceApp />);
    </script>
</body>
</html>
